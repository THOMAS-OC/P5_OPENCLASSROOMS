const sectionArticle=document.querySelector("#cart__items"),articleHTML=document.getElementsByTagName("article"),buttonSubmit=document.getElementById("order");let myCart=[],listIdCart=[];function refreshNbArticles(){let e=localStorage.length,t=e>1?"s":"";document.querySelector("#totalQuantity").innerText=`${e} article${t}`}function refreshPrixTotal(){let e=0;for(let t of articleHTML)e+=t.querySelector(".articlePrice").innerText*t.querySelector(".itemQuantity").value;document.querySelector("#totalPrice").innerText=e}function refreshArrayCart(){myCart=[],listIdCart=[];for(let e of Object.keys(localStorage))productArray=[],productArray.push(e.split(" ")[0]),listIdCart.push(e.split(" ")[0]),productArray.push(e.split(" ")[1]),productArray.push(localStorage.getItem(e)),myCart.push(productArray)}for(refreshArrayCart(),nbArticles=localStorage.length,createIndex=1;createIndex<nbArticles;){createIndex++;let e=document.querySelector(".cart__item").cloneNode(!0);sectionArticle.appendChild(e)}refreshNbArticles();let i=0;for(let e of myCart)fetch(`http://localhost:3000/api/products/${e[0]}`).then(e=>e.json()).then(t=>{articleHTML[i].setAttribute("data-id",e[0]),articleHTML[i].setAttribute("data-color",e[1]),articleHTML[i].querySelector(".cart__item__content__description").innerHTML=`<h2> ${t.name} <h2> <p> ${e[1]} </p> <p> <span class="articlePrice"> ${t.price} </span> â‚¬ </p>`,articleHTML[i].querySelector("img").src=t.imageUrl,articleHTML[i].querySelector(".itemQuantity").value=e[2],articleHTML[i].querySelector(".itemQuantity").setAttribute("value",e[2]),articleHTML[i].style.display="flex",i++,refreshPrixTotal()});const buttonsDelete=document.querySelectorAll(".deleteItem");buttonsDelete.forEach(e=>{e.addEventListener("click",()=>{parentButton=e.parentElement.parentElement.parentElement.parentElement,idDelete=`${parentButton.getAttribute("data-id")} ${parentButton.getAttribute("data-color")}`,localStorage.removeItem(idDelete),e.parentElement.parentElement.parentElement.parentElement.remove(),refreshNbArticles(),refreshPrixTotal(),refreshArrayCart()})});const quantityItems=document.querySelectorAll(".itemQuantity");quantityItems.forEach(e=>{e.addEventListener("change",()=>{parentQuantity=e.parentElement.parentElement.parentElement.parentElement,idChange=`${parentQuantity.getAttribute("data-id")} ${parentQuantity.getAttribute("data-color")}`,e.setAttribute("value",e.value),localStorage.setItem(idChange,e.value),refreshPrixTotal(),refreshArrayCart()})});let contact={firstName:"",lastName:"",address:"",city:"",email:""},products=listIdCart;buttonSubmit.addEventListener("click",e=>{e.preventDefault(),validForm=!1;for(let e of Object.keys(contact))contact[e]=document.getElementById(e).value.trim();let t=/^[A-Za-z]+$/;console.log(contact.lastName),contact.lastName.match(t)?contact.firstName.match(t)?contact.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)?contact.city?contact.address?validForm=!0:alert("Veuillez renseigner votre adresse"):alert("Veuillez renseigner une ville"):alert("Veuillez saisir une adresse email valide svp"):alert("Veuillez saisir prenom svp "):alert("Veuillez saisir nom svp "),contact.lastName=contact.lastName.toUpperCase(),contact.firstName=contact.firstName.toLowerCase();var r=new Headers;r.append("Content-Type","application/json");let a=JSON.stringify({contact:contact,products:products});validForm&&fetch("http://localhost:3000/api/products/order",{method:"POST",headers:r,body:a,redirect:"follow"}).then(e=>e.json()).then(e=>{location.assign(location.href.replace("cart.html",`confirmation.html?id=${e.orderId}`))}).catch(e=>console.log("error",e))});